<div class="row my-5 justify-content-center">
  <div class="col-8 col-md-6 col-lg-4">
    <h3 class="text-center mb-5">로그인</h3>
    <form id="frm" method="post">
      <div class="input-group my-2">
        <div class="input-group-text">이 메 일</div>
        <input class="form-control" id="email" value="tomato@hot.com" />
      </div>
      <div class="input-group">
        <div class="input-group-text">비밀번호</div>
        <input class="form-control" id="password" type="password" value="12345678" />
      </div>
      <div class="my-3">
        <button class="btn btn-success w-100">로그인</button>
      </div>
      <div class="my-3">
        <button id="google" type="button" class="btn btn-primary w-100">Google</button>
      </div>
      <div class="my-3">
        <button onclick="handleNaverLogin(event)" type="button" class="btn btn-secondary w-100">Naver</button>
      </div>
      <div class="text-end mt-3">
        <span id="join">
          <!-- http://localhost:3000/users/join -->
          <a href="/users/join">회원가입</a>
        </span>
        <span id="profile" style="display: none">
          <a href="/profile">정보수정</a>
        </span>
      </div>
    </form>
    <div class="my-3">
      <button onclick="handleKakaoLogin(event)" style="border: none; background: none; padding: 0; outline: none">
        <img src="/images/kakao/kakao_login_medium_wide.png" alt="카카오로그인" />
      </button>
    </div>
  </div>
</div>
<script type="module">
  import { app } from '/javascripts/firebase.js'
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
  const auth = getAuth(app);


  const frm = document.querySelector('#frm')
  frm.addEventListener('submit',function(event){
    // submit 이슈해결하기 위해 아래 코드 추가
    // 이벤트 전이 방지
    event.preventDefault();
    const email = document.querySelector('#email').value;
    const password = document.querySelector('#password').value;
    console.log(`사용자가 입력한 이메일 ${email}, 비밀번호 ${password}`);
    
    // firebase에서 제공되는 메서드이다.
    // 파라미터 세 개 auth, email, password
    // firebase 서버를 경유한다. -> 지연이 발생할 수도 있다. - waiting - pending
    // 자바스크립트는 동기적으로 처리함 - 디폴트 값
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => { // 요청에 대한 응답이 오면 파라미터에 사용자 정보가 담김
        // Signed in 
        const user = userCredential.user;
        console.log(JSON.stringify(user));
        // 로그인이 성공했나요?
        if (user.uid) // 참이면 구글에서 응답으로 보내준 uid값이 있다.
        {
          window.localStorage.setItem("uid", user.uid);
          window.localStorage.setItem("email",user.email);

          location.href='/';
        }
        else
        {
          console.log("로그인 실패");
        }
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
      });
  })

</script>